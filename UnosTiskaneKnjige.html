<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unos – Tiskana knjiga u više svezaka | KAM</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;color:#1f2937;background:#f6f7fb}
    header{padding:16px 20px;border-bottom:1px solid #e5e7eb;background:#fff;position:sticky;top:0;z-index:10}
    header h1{margin:0;font-size:18px}
    main{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:14px 0}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    label{font-size:13px;color:#6b7280}
    input,select,textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px}
    .cols-12{grid-column:span 12}.cols-8{grid-column:span 8}.cols-6{grid-column:span 6}.cols-4{grid-column:span 4}.cols-3{grid-column:span 3}.cols-2{grid-column:span 2}
    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
    button{border:0;border-radius:10px;padding:10px 16px;cursor:pointer}
    .primary{background:#6d28d9;color:#fff}
    .ghost{background:transparent;border:1px solid #e5e7eb}
    pre{background:#0b1020;color:#cfe8ff;border-radius:10px;padding:14px;white-space:pre-wrap}
    .err{color:#b91c1c;font-weight:600}
    h2{margin:0 0 8px;font-size:16px}
  </style>
</head>
<body>
  <header>
    <h1>KAM – Unos tiskane knjige u više svezaka</h1>
  </header>

  <main>
    <form id="kamForm">
      <!-- STVARNI PRIKAZ -->
      <section class="card">
        <h2>1. Stvarni prikaz (ISBD)</h2>
        <div class="row">
          <div class="cols-8">
            <label for="e1_4">1.4 Glavni stvarni naslov</label>
            <input id="e1_4" />
          </div>
          <div class="cols-4">
            <label for="e1_6">1.6 Dodatak glavnom stvarnom naslovu</label>
            <input id="e1_6" />
          </div>
          <div class="cols-12">
            <label for="e1_9">1.9 Odgovornost uz stvarni naslov</label>
            <input id="e1_9" placeholder="npr. autor ; ilustrator ; prevoditelj" />
          </div>
          <div class="cols-4">
            <label for="e1_12">1.12 Podatak o izdanju</label>
            <input id="e1_12" placeholder="npr. III. izdanje" />
          </div>
          <div class="cols-4">
            <label for="e1_21">1.21 Mjesto izdavanja</label>
            <input id="e1_21" placeholder="npr. Zagreb" />
          </div>
          <div class="cols-4">
            <label for="e1_23">1.23 Nakladnik / proizvođač</label>
            <input id="e1_23" placeholder="npr. Nakladnik d.o.o." />
          </div>
          <div class="cols-4">
            <label for="e1_25">1.25 Godina / vremenski raspon izdavanja</label>
            <input id="e1_25" placeholder="npr. 2000–2001" />
          </div>
          <div class="cols-4">
            <label for="e1_34">1.34 Nakladnička cjelina</label>
            <input id="e1_34" placeholder="npr. Biblioteka X" />
          </div>
          <div class="cols-4">
            <label for="e1_38">1.38 Numeracija u nakladničkoj cjelini</label>
            <input id="e1_38" placeholder="npr. 11" />
          </div>
        </div>
      </section>

      <!-- IDENTIFIKACIJA -->
      <section class="card">
        <h2>2. Identifikacija jedinice građe</h2>
        <div class="row">
          <div class="cols-3">
            <label for="e2_1">2.1 Razina opisa djela</label>
            <input id="e2_1" placeholder="pojedinačno / skupno" />
          </div>
          <div class="cols-3">
            <label for="e2_2">2.2 Razina opisa pojavnog oblika</label>
            <input id="e2_2" placeholder="pojedinačni / skupni" />
          </div>
          <div class="cols-3">
            <label for="e2_4">2.4 Medij</label>
            <input id="e2_4" placeholder="neposredovan/posredovan" />
          </div>
          <div class="cols-3">
            <label for="e2_5">2.5 Oblik sadržaja</label>
            <input id="e2_5" placeholder="tekst" />
          </div>
          <div class="cols-6">
            <label for="e2_6">2.6 Identifikator djela</label>
            <input id="e2_6" placeholder="VIAF / ISNI / Wikidata…" />
          </div>
          <div class="cols-6">
            <label for="e2_7">2.7 Usvojena pristupnica za djelo</label>
            <input id="e2_7" placeholder="Autor… Naslov…" />
          </div>
          <div class="cols-6">
            <label for="e2_18">2.18 Usvojena pristupnica za izraz</label>
            <input id="e2_18" placeholder="… Hrvatski" />
          </div>
          <div class="cols-6">
            <label for="e2_22">2.22 Identifikator pojavnog oblika</label>
            <input id="e2_22" placeholder="ISBN (cjelina i dijelovi); drugi ID-evi" />
          </div>
          <div class="cols-12">
            <label for="e2_23">2.23 Usvojena pristupnica za pojavni oblik</label>
            <input id="e2_23" placeholder="npr. Molitva žabe" />
          </div>
        </div>
      </section>

      <!-- TEMATIKA -->
      <section class="card">
        <h2>3. Tematika i sadržaj</h2>
        <div class="row">
          <div class="cols-4">
            <label for="e3_8">3.8 Oblik/žanr</label>
            <input id="e3_8" placeholder="npr. kratke priče" />
          </div>
          <div class="cols-4">
            <label for="e3_7">3.7 Područje (UDK)</label>
            <input id="e3_7" placeholder="npr. 82-3=163.42" />
          </div>
          <div class="cols-2">
            <label for="e3_11">3.11 Jezik sadržaja</label>
            <input id="e3_11" placeholder="hrvatski" />
          </div>
          <div class="cols-2">
            <label for="e3_13">3.13 Jezik izvornika</label>
            <input id="e3_13" placeholder="engleski" />
          </div>
          <div class="cols-12">
            <label for="e3_19">3.19 Ilustracije</label>
            <input id="e3_19" placeholder="Ilustr." />
          </div>
        </div>
      </section>

      <!-- MATERIJALNI OPIS -->
      <section class="card">
        <h2>4. Materijalni opis</h2>
        <div class="row">
          <div class="cols-6">
            <label for="e4_1">4.1 Opseg</label>
            <input id="e4_1" placeholder="npr. 2 sv. (195;196 str.)" />
          </div>
          <div class="cols-6">
            <label for="e4_5">4.5 Dimenzije</label>
            <input id="e4_5" placeholder="npr. 19 cm" />
          </div>
        </div>
      </section>

      <!-- ŽIVOTNI CIKLUS -->
      <section class="card">
        <h2>5. Životni ciklus jedinice građe</h2>
        <div class="row">
          <div class="cols-6">
            <label for="e5_10">5.10 Način nabave</label>
            <input id="e5_10" placeholder="npr. obvezni primjerak" />
          </div>
        </div>
      </section>

      <!-- DOSTUPNOST -->
      <section class="card">
        <h2>6. Dostupnost i uporaba</h2>
        <div class="row">
          <div class="cols-6">
            <label for="e6_10">6.10 Dostupnost primjerka</label>
            <input id="e6_10" placeholder="npr. korištenje u čitaonici" />
          </div>
        </div>
      </section>

      <!-- ODNOSI -->
      <section class="card">
        <h2>10. Odnosi i napomene o odnosima</h2>
        <div class="row">
          <div class="cols-12">
            <label for="e10_2">10.2 Odnos djela i izraza</label>
            <input id="e10_2" placeholder="Prijevod: The prayer of the frog → Hrvatski" />
          </div>
          <div class="cols-12">
            <label for="e10_3">10.3 Odnos izraza i izraza</label>
            <input id="e10_3" placeholder="Biblioteka X → Dio: Naslov" />
          </div>
          <div class="cols-6">
            <label for="e10_9">10.9 Odnos djela i stvaratelja</label>
            <input id="e10_9" placeholder="Autor: Prezime, Ime, godina–godina" />
          </div>
          <div class="cols-6">
            <label for="e10_10">10.10 Odnos izraza i agenta</label>
            <input id="e10_10" placeholder="Prevoditelj: …" />
          </div>
          <div class="cols-6">
            <label for="e10_11">10.11 Odnos pojavnog oblika i agenta</label>
            <input id="e10_11" placeholder="Ilustrator: …" />
          </div>
        </div>
      </section>

      <div class="actions">
        <button type="button" class="ghost" id="testBtn">Test</button>
        <button type="submit" class="primary">Generiraj JSON-LD</button>
      </div>
    </form>

    <div class="card">
      <strong>Rezultat</strong>
      <pre id="output"></pre>
      <div id="error" class="err"></div>
    </div>
  </main>

  <script>
    (function(){
      const out = document.getElementById('output');
      const err = document.getElementById('error');
      const v = id => (document.getElementById(id)?.value || '').trim();

      // Stabilni ID-jevi (sinkron, bez crypto/BigInt)
      function hash32(str){
        let h = 5381;
        for(let i=0;i<str.length;i++){ h = ((h<<5)+h) + str.charCodeAt(i); h |= 0; }
        return (h>>>0).toString(16).padStart(8,'0');
      }
      function idFor(nsType, content){
        return 'http://www.registar.kam.hr/id/' + hash32(nsType+'|'+(content||''));
      }

      // KAM klase
      const C = {
        PojavniOblik:'http://www.registar.kam.hr/Element/c/C10004',
        Nomen:'http://www.registar.kam.hr/Element/c/C10013',
        Mjesto:'http://www.registar.kam.hr/Element/c/C10011',
        Vrijeme:'http://www.registar.kam.hr/Element/c/C10012'
      };

      // KAM svojstva (poznata i potvrđena)
      const P = {
        glavniNaslov:'http://www.registar.kam.hr/Elements/po/P40004',
        dodatakNaslovu:'http://www.registar.kam.hr/Elements/po/P40006',
        odgovornostNaslov:'http://www.registar.kam.hr/Elements/po/P40009',
        podatakOIzd:'http://www.registar.kam.hr/Elements/po/P40012',
        imeNakladnika:'http://www.registar.kam.hr/Elements/po/P40023',
        opseg:'http://www.registar.kam.hr/Elements/po/P40046',
        dimenzije:'http://www.registar.kam.hr/Elements/po/P40050',
        nakladnickaCjelina:'http://www.registar.kam.hr/Elements/po/P40034',
        identifikatorPojOblika:'http://www.registar.kam.hr/Elements/po/P40319',
        mjestoIzdavanja:'http://www.registar.kam.hr/Elements/po/P40301',
        vrijemeIzdavanja:'http://www.registar.kam.hr/Elements/po/P40306',
        nomenskiNiz:'http://www.registar.kam.hr/Elements/n/P13002',
        usvojenaPristupnicaMjesto:'http://www.registar.kam.hr/Elements/m/P11044',
        usvojenaPristupnicaVrijeme:'http://www.registar.kam.hr/Elements/vr/P12038'
      };

      // Pomoćne tvorbene funkcije
      function makeNomen(graph, text, lang){
        if(!text) return null;
        const id = idFor(C.Nomen, (lang||'')+'|'+text);
        graph.push({ '@id': id, '@type': C.Nomen, [P.nomenskiNiz]: [{ '@value': text, ...(lang?{'@language':lang}:{}) }] });
        return id;
      }
      function makeMjesto(graph, naziv){
        if(!naziv) return null;
        const id = idFor(C.Mjesto, naziv);
        const nId = makeNomen(graph, naziv, 'hr');
        graph.push({ '@id': id, '@type': C.Mjesto, [P.usvojenaPristupnicaMjesto]: nId ? [{ '@id': nId }] : [] });
        return id;
      }
      function makeVrijeme(graph, raspon){
        if(!raspon) return null;
        const id = idFor(C.Vrijeme, raspon);
        const nId = makeNomen(graph, raspon, '');
        graph.push({ '@id': id, '@type': C.Vrijeme, [P.usvojenaPristupnicaVrijeme]: nId ? [{ '@id': nId }] : [] });
        return id;
      }

      // Mapiranje polja forme na KAM svojstva (proširivo)
      const MAP_FIELDS = [
        // Stvarni prikaz
        {id:'e1_4', prop:P.glavniNaslov, lang:'hr'},
        {id:'e1_6', prop:P.dodatakNaslovu, lang:'hr'},
        {id:'e1_9', prop:P.odgovornostNaslov, lang:'hr'},
        {id:'e1_12', prop:P.podatakOIzd, lang:'hr'},
        {id:'e1_23', prop:P.imeNakladnika, lang:'hr'},
        {id:'e1_34', prop:P.nakladnickaCjelina, lang:'hr'},
        {id:'e2_22', prop:P.identifikatorPojOblika, lang:''},
        // Tematika (jezici često se vežu na Izraz; ovdje privremeno kao nomenski niz)
        {id:'e3_11', prop:P.nomenskiNiz, lang:'hr'}, // Jezik sadržaja -> Nomen tekst
        {id:'e3_13', prop:P.nomenskiNiz, lang:'hr'}, // Jezik izvornika -> Nomen tekst
        {id:'e3_8',  prop:P.nomenskiNiz, lang:'hr'}, // Oblik/žanr -> Nomen tekst
        {id:'e3_7',  prop:P.nomenskiNiz, lang:''},   // UDK -> literalni niz (bez @language)
        {id:'e3_19', prop:P.nomenskiNiz, lang:'hr'}, // Ilustracije -> Nomen tekst
        // Materijalni opis
        {id:'e4_1', prop:P.opseg, lang:''},
        {id:'e4_5', prop:P.dimenzije, lang:''}
      ];

      function toKAMJsonLD(){
        const graph = [];

        // Pojavni oblik ID iz stabilnih polja
        const poKey = [v('e1_4'), v('e1_23'), v('e1_25'), v('e2_22')].filter(Boolean).join('|') || 'tmp';
        const poId = idFor(C.PojavniOblik, poKey);
        const po = { '@id': poId, '@type': C.PojavniOblik };

        // Prolaz kroz mapiranja (stvara Nomene i veže ih na po)
        MAP_FIELDS.forEach(({id, prop, lang})=>{
          const val = v(id); if(!val) return;
          const nId = makeNomen(graph, val, lang);
          if(prop === P.nomenskiNiz){
            // ako nemamo precizno svojstvo na po, ne vežemo direktno;
            // Nomen ipak ulazi u graf (kasnije ga se može semantički povezati!)
            return;
          }
          po[prop] = (po[prop]||[]).concat([{ '@id': nId }]);
        });

        // Mjesto i Vrijeme su entiteti
        const mjestoId = makeMjesto(graph, v('e1_21')); if(mjestoId) po[P.mjestoIzdavanja] = [{ '@id': mjestoId }];
        const vrijemeId = makeVrijeme(graph, v('e1_25')); if(vrijemeId) po[P.vrijemeIzdavanja] = [{ '@id': vrijemeId }];

        graph.push(po);
        return { '@graph': graph };
      }

      const form = document.getElementById('kamForm');
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        err.textContent = '';
        try{
          const data = toKAMJsonLD();
          out.textContent = JSON.stringify(data, null, 2);
        }catch(ex){
          err.textContent = 'Greška: '+ex.message;
          console.error(ex);
        }
      });

      // Test gumb za brzu provjeru
      document.getElementById('testBtn').addEventListener('click', ()=>{
        document.getElementById('e1_4').value = 'Molitva žabe';
        document.getElementById('e1_23').value = 'KS';
        document.getElementById('e1_25').value = '2000–2001';
        document.getElementById('e2_22').value = 'ISBN 953-123-456-7';
        const data = toKAMJsonLD();
        out.textContent = JSON.stringify(data, null, 2);
      });
    })();
  </script>
</body>
</html>
