<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAM Ontology Property</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&family=Rubik:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<div id="menu-bar">
    <img src="kam.png" alt="KAM Logo" class="logo">
    <h1><a href="index.html" style="text-decoration:none; color:inherit;">Registar</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h1>
    <div>
        <a href="index.html" onclick="redirectToIndex('klase'); return false;">KLASE</a>
    </div>
    <div>
        <a href="index.html" onclick="redirectToIndex('svojstva'); return false;">SVOJSTVA</a>
    </div>
    <div>
        <a href="index.html" onclick="redirectToIndex('prefiksi'); return false;">PREFIKSI</a>
    </div>
    <div>
        <a href="index.html" onclick="redirectToIndex('pomoc'); return false;">Pomoć</a>
    </div>
</div>

<div id="content">
    <p>Detalji za CURIE entitet.</p>
</div>

<!-- Footer with black background and white text -->
<div id="footer">
    © 2024 Nacionalna i sveučilišna knjižnica u Zagrebu. Sva prava pridržana. | Hrvatske bratske zajednice 4, 10000 Zagreb, Hrvatska | Tel. +385 1 616 4021
</div>

<script>
// Helper function to redirect to index.html with parameters
function redirectToIndex(section) {
    const urlParams = new URLSearchParams(window.location.search);
    const curie = urlParams.get('curie');
    if (section === 'klase' || section === 'svojstva' || section === 'prefiksi' || section === 'pomoc') {
        window.location.href = `index.html?section=${section}&curie=${curie}`;
    } else {
        window.location.href = `index.html?curie=${curie}`;
    }
}

// Fetch the ontology data from localStorage
const ontologyData = JSON.parse(localStorage.getItem('ontologyData'));

// Get the CURIE from the URL parameters
const urlParams = new URLSearchParams(window.location.search);
const curie = urlParams.get('curie');

// Function to generate download links
function generateDownloadLinks(curie) {
    const className = curie.split(':')[1].toLowerCase().replace(/ /g, '_');
    const jsonLdLink = `ontology_elements_${className}.jsonld`;
    const csvLink = `ontology_elements_${className}.csv`;
    const rdfXmlLink = `ontology_elements_${className}.rdf`;

    const table1 = `
        <table>
            <tr>
                <td>Preuzimanja:</td>
                <td><a href="${jsonLdLink}" download>JSON_LD</a></td>
                <td><a href="${csvLink}" download>CSV</a></td>
                <td><a href="${rdfXmlLink}" download>RDF/XML</a></td>
            </tr>
        </table>
    `;
    return table1;
}

// Function to get the last modified date
function getLastModifiedDate() {
    const lastModified = document.lastModified;
    const table2 = `<table><tr><td>Posljednja izmjena: ${lastModified}</td></tr></table>`;
    return table2;
}

// Display the details of the property on the page
function displayPropertyDetails(curie, data) {
    const content = document.getElementById('content');
    const property = Object.values(data).find(item => {
        return item['http://www.registar.kam.hr/ontologies/ont.owl/ID'] && item['http://www.registar.kam.hr/ontologies/ont.owl/ID'][0]['@value'] === curie;
    });

    if (property) {
        const label = property['http://www.w3.org/2000/01/rdf-schema#label']
            ? property['http://www.w3.org/2000/01/rdf-schema#label'][0]['@value']
            : 'Unknown Label';
        const definition = property['http://www.registar.kam.hr/ontologies/ont.owl/definition']
            ? property['http://www.registar.kam.hr/ontologies/ont.owl/definition'][0]['@value']
            : 'No definition available';
        const range = property['http://www.w3.org/2000/01/rdf-schema#range']
            ? property['http://www.w3.org/2000/01/rdf-schema#range'][0]['@id']
            : 'No Range';
        const subPropertyOf = property['http://www.w3.org/2000/01/rdf-schema#subPropertyOf']
            ? property['http://www.w3.org/2000/01/rdf-schema#subPropertyOf'][0]['@id']
            : 'No subPropertyOf';
        const inverseOf = property['http://www.w3.org/2002/07/owl#inverseOf']
            ? property['http://www.w3.org/2002/07/owl#inverseOf'][0]['@id']
            : 'No inverseOf';

        content.innerHTML = `<h2>Details for CURIE: ${curie}</h2>`;
        let table = `<table id="propertyTable" class="display">
            <thead><tr><th>Property</th><th>Value</th></tr></thead>
            <tbody>
            <tr><td>Label</td><td>${label}</td></tr>
            <tr><td>Definition</td><td>${definition}</td></tr>
            <tr><td>Range</td><td>${range}</td></tr>
            <tr><td>subPropertyOf</td><td>${subPropertyOf}</td></tr>
            <tr><td>inverseOf</td><td>${inverseOf}</td></tr>
            </tbody></table>`;
        
        content.innerHTML += table;

        // Add the two additional tables
        const downloadTable = generateDownloadLinks(curie);
        const modifiedTable = getLastModifiedDate();

        content.innerHTML += downloadTable;
        content.innerHTML += modifiedTable;

        $(document).ready(function() {
            $('#propertyTable').DataTable();
        });
    } else {
        content.innerHTML = '<p>Details not found for the selected CURIE.</p>';
    }
}

// Initialize the CURIE details
displayPropertyDetails(curie, ontologyData);
</script>

</body>
</html>
